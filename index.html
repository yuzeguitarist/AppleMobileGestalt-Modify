<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MobileGestalt Plist Editor</title>
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* åŸºç¡€æ ·å¼ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --yellow-primary: #FFD60A;
      --black: #000000;
      --white: #FFFFFF;
      --off-white: #F5F5F5;
      --light-gray: #E0E0E0;
      --medium-gray: #999999;
      --dark-gray: #333333;
      --blue-primary: #4DA3FF;
      --blue-hover: #3D93EF;
      --teal: #4ECDC4;
      --coral: #FF6B6B;
      --error: #F44336;
      --success: #4CAF50;
      --font-heading: 'Space Mono', monospace;
      --font-body: 'Inter', sans-serif;
    }

    body {
      font-family: var(--font-body);
      background: var(--white);
      color: var(--black);
      line-height: 1.6;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* é»„è‰²æ¨ªå¹… */
    .warning-banner {
      width: 100%;
      background: var(--yellow-primary);
      border-top: 3px solid var(--black);
      border-bottom: 3px solid var(--black);
      padding: 8px 0;
      overflow: hidden;
      position: relative;
    }

    .warning-banner-text {
      display: inline-block;
      white-space: nowrap;
      animation: marquee 30s linear infinite;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      font-size: 14px;
    }

    @keyframes marquee {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* å®¹å™¨ */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 16px;
      flex: 1;
    }

    /* æ ‡é¢˜åŒº */
    .header {
      text-align: center;
      margin-bottom: 48px;
    }

    .header h1 {
      font-family: var(--font-heading);
      font-size: 48px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: -0.02em;
      margin-bottom: 16px;
      line-height: 1.1;
    }

    .header p {
      font-size: 16px;
      color: var(--dark-gray);
      max-width: 600px;
      margin: 0 auto;
    }

    .header .info-text {
      background: var(--off-white);
      border: 2px solid var(--black);
      padding: 16px;
      margin: 16px auto 0;
      max-width: 600px;
      font-size: 14px;
      line-height: 1.8;
      text-align: left;
    }

    .header .info-text strong {
      color: var(--coral);
      font-weight: 700;
    }

    /* å¡ç‰‡ */
    .card {
      background: var(--white);
      border: 3px solid var(--black);
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: 6px 6px 0px var(--black);
      transition: all 0.2s ease-out;
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
    }

    .badge {
      display: inline-block;
      padding: 4px 12px;
      background: var(--yellow-primary);
      border: 2px solid var(--black);
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .card-title {
      font-family: var(--font-heading);
      font-size: 24px;
      font-weight: 700;
      text-transform: uppercase;
    }

    /* è¾“å…¥åŒºåŸŸ */
    .input-group {
      margin-bottom: 24px;
    }

    .input-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 8px;
      color: var(--dark-gray);
    }

    .input-field {
      width: 100%;
      padding: 12px 16px;
      background: var(--white);
      border: 2px solid var(--black);
      font-size: 16px;
      font-family: var(--font-body);
      transition: all 0.2s ease-out;
      resize: vertical;
      min-height: 300px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.4;
    }

    .input-field:focus {
      outline: none;
      border-width: 3px;
      box-shadow: 4px 4px 0px var(--black);
    }

    .input-field.small {
      min-height: auto;
      height: 48px;
    }

    .input-field.error {
      border-color: var(--error);
    }

    .error-message {
      color: var(--error);
      font-size: 12px;
      font-weight: 600;
      margin-top: 8px;
      display: none;
      white-space: pre-wrap;
      line-height: 1.6;
      background: #ffebee;
      padding: 12px;
      border: 2px solid var(--error);
      border-radius: 4px;
    }

    .error-message.show {
      display: block;
    }

    /* æŒ‰é’® */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 32px;
      background-color: var(--blue-primary);
      color: var(--white);
      border: 3px solid var(--black);
      font-family: var(--font-body);
      font-size: 16px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      box-shadow: 4px 4px 0px var(--black);
      transition: all 0.2s ease-out;
      cursor: pointer;
      text-decoration: none;
    }

    .btn:hover:not(:disabled) {
      transform: translate(-2px, -2px);
      box-shadow: 6px 6px 0px var(--black);
      background-color: var(--blue-hover);
    }

    .btn:active:not(:disabled) {
      transform: translate(0, 0);
      box-shadow: 2px 2px 0px var(--black);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn-secondary {
      background-color: var(--white);
      color: var(--black);
    }

    .btn-secondary:hover:not(:disabled) {
      background-color: var(--yellow-primary);
    }

    .btn-success {
      background-color: var(--success);
    }

    .btn-group {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
    }

    /* Plist æŸ¥çœ‹å™¨ */
    .plist-viewer {
      background: var(--off-white);
      border: 2px solid var(--black);
      padding: 16px;
      max-height: 500px;
      overflow-y: auto;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      display: none;
    }

    .plist-viewer.show {
      display: block;
    }

    .plist-tree {
      list-style: none;
      padding-left: 0;
    }

    .plist-tree ul {
      list-style: none;
      padding-left: 24px;
    }

    .plist-item {
      margin: 4px 0;
      display: flex;
      align-items: baseline;
      gap: 8px;
    }

    .plist-key {
      color: var(--coral);
      font-weight: 600;
    }

    .plist-type {
      color: var(--medium-gray);
      font-size: 11px;
      text-transform: uppercase;
    }

    .plist-value {
      color: var(--dark-gray);
      word-break: break-all;
    }

    .plist-value.highlight {
      background: var(--yellow-primary);
      padding: 2px 4px;
      border: 1px solid var(--black);
      font-weight: 700;
    }

    .plist-toggle {
      cursor: pointer;
      user-select: none;
      color: var(--blue-primary);
      font-weight: 700;
      margin-right: 4px;
    }

    .plist-toggle:hover {
      color: var(--blue-hover);
    }

    .collapsed {
      display: none;
    }

    /* å“åº”å¼ */
    @media (max-width: 768px) {
      .container {
        padding: 24px 12px;
      }

      .header h1 {
        font-size: 28px;
        line-height: 1.2;
      }

      .header p {
        font-size: 14px;
      }

      .header .info-text {
        font-size: 13px;
        padding: 12px;
        line-height: 1.6;
      }

      .card {
        padding: 20px 12px;
        box-shadow: 4px 4px 0px var(--black);
        margin-bottom: 16px;
      }

      .card-header {
        flex-wrap: wrap;
        margin-bottom: 16px;
      }

      .card-title {
        font-size: 18px;
      }

      .btn-group {
        flex-direction: column;
      }

      .btn {
        width: 100%;
        font-size: 14px;
        padding: 10px 24px;
      }

      .file-input-label {
        width: 100%;
        font-size: 14px;
        padding: 10px 24px;
        box-sizing: border-box;
      }

      .file-name {
        display: block;
        margin-left: 0;
        margin-top: 8px;
        font-size: 12px;
      }

      .input-field {
        font-size: 11px;
        padding: 10px 12px;
      }

      .plist-viewer {
        font-size: 11px;
        padding: 12px;
        max-height: 400px;
      }

      .usage-guide {
        padding: 16px 12px;
        box-shadow: 4px 4px 0px var(--black);
      }

      .usage-guide h3 {
        font-size: 16px;
      }

      .usage-guide ol {
        font-size: 13px;
        line-height: 1.8;
        margin-left: 16px;
      }

      .history-item {
        flex-direction: column;
        align-items: stretch;
      }

      .btn-small {
        width: 100%;
      }

      .warning-banner-text {
        font-size: 12px;
      }
    }

    /* åŠ è½½çŠ¶æ€ */
    .loading {
      display: none;
      text-align: center;
      padding: 24px;
      font-weight: 600;
      color: var(--dark-gray);
    }

    .loading.show {
      display: block;
    }

    /* éšè—å…ƒç´  */
    .hidden {
      display: none !important;
    }

    /* é¡µè„š */
    .footer {
      background: var(--black);
      color: var(--white);
      padding: 32px 16px;
      text-align: center;
      border-top: 3px solid var(--black);
      margin-top: 48px;
    }

    .footer-content {
      max-width: 1200px;
      margin: 0 auto;
    }

    .footer-author {
      font-family: var(--font-heading);
      font-size: 20px;
      font-weight: 700;
      text-transform: uppercase;
      margin-bottom: 12px;
      letter-spacing: 0.1em;
    }

    .footer-copyright {
      font-size: 14px;
      color: var(--light-gray);
      font-weight: 500;
    }

    @media (max-width: 768px) {
      .footer {
        padding: 24px 12px;
        margin-top: 32px;
      }

      .footer-author {
        font-size: 16px;
      }

      .footer-copyright {
        font-size: 12px;
      }
    }

    /* æ–‡ä»¶è¾“å…¥åŒºåŸŸ */
    .file-input-wrapper {
      position: relative;
      margin-bottom: 16px;
    }

    .file-input-label {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 32px;
      background-color: var(--teal);
      color: var(--white);
      border: 3px solid var(--black);
      font-family: var(--font-body);
      font-size: 16px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      box-shadow: 4px 4px 0px var(--black);
      transition: all 0.2s ease-out;
      cursor: pointer;
    }

    .file-input-label:hover {
      transform: translate(-2px, -2px);
      box-shadow: 6px 6px 0px var(--black);
    }

    #fileInput {
      display: none;
    }

    .file-name {
      display: inline-block;
      margin-left: 16px;
      font-size: 14px;
      color: var(--dark-gray);
      font-weight: 600;
    }

    /* æˆåŠŸæç¤º */
    .success-message {
      background: var(--success);
      color: var(--white);
      padding: 16px;
      border: 3px solid var(--black);
      box-shadow: 4px 4px 0px var(--black);
      margin-bottom: 24px;
      font-weight: 600;
      text-align: center;
      display: none;
    }

    .success-message.show {
      display: block;
    }

    /* é£é™©è­¦å‘Šæ¨¡æ€æ¡† */
    .risk-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 16px;
    }

    .risk-modal-overlay.hidden {
      display: none;
    }

    .risk-modal {
      background: var(--white);
      max-width: 600px;
      width: 100%;
      border: 4px solid var(--black);
      box-shadow: 12px 12px 0px var(--black);
      max-height: 90vh;
      overflow-y: auto;
      animation: modalSlideIn 0.3s ease-out;
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .risk-modal-header {
      background: var(--error);
      color: var(--white);
      padding: 24px;
      border-bottom: 4px solid var(--black);
    }

    .risk-modal-header h2 {
      font-family: var(--font-heading);
      font-size: 28px;
      font-weight: 900;
      text-transform: uppercase;
      letter-spacing: -0.01em;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .risk-modal-body {
      padding: 32px;
      background: var(--white);
    }

    .risk-modal-body ul {
      margin-left: 20px;
      line-height: 2;
      color: var(--error);
      font-weight: 600;
      font-size: 15px;
    }

    .risk-modal-body ul li {
      margin-bottom: 12px;
    }

    .risk-modal-body strong {
      color: var(--black);
      font-weight: 700;
    }

    .risk-modal-footer {
      padding: 24px 32px;
      border-top: 3px solid var(--light-gray);
      background: var(--off-white);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }

    .risk-modal-timer {
      font-family: var(--font-heading);
      font-size: 18px;
      font-weight: 700;
      color: var(--error);
      text-transform: uppercase;
    }

    .risk-modal-btn {
      padding: 16px 48px;
      background: var(--black);
      color: var(--white);
      border: 3px solid var(--black);
      font-family: var(--font-body);
      font-size: 18px;
      font-weight: 700;
      text-transform: uppercase;
      box-shadow: 4px 4px 0px var(--error);
      cursor: not-allowed;
      opacity: 0.5;
      transition: all 0.2s ease-out;
      width: 100%;
      max-width: 300px;
    }

    .risk-modal-btn.active {
      cursor: pointer;
      opacity: 1;
      background: var(--error);
    }

    .risk-modal-btn.active:hover {
      transform: translate(-2px, -2px);
      box-shadow: 6px 6px 0px var(--black);
    }

    .risk-modal-btn.active:active {
      transform: translate(0, 0);
      box-shadow: 2px 2px 0px var(--black);
    }

    .risk-note {
      background: var(--yellow-primary);
      border: 3px solid var(--black);
      padding: 16px;
      margin-top: 16px;
      font-size: 14px;
      line-height: 1.6;
      color: var(--black);
      font-weight: 600;
    }

    @media (max-width: 768px) {
      .risk-modal {
        box-shadow: 8px 8px 0px var(--black);
      }

      .risk-modal-header {
        padding: 16px;
      }

      .risk-modal-header h2 {
        font-size: 20px;
      }

      .risk-modal-body {
        padding: 20px 16px;
      }

      .risk-modal-body ul {
        font-size: 14px;
        line-height: 1.8;
        margin-left: 16px;
      }

      .risk-modal-footer {
        padding: 16px;
      }

      .risk-modal-btn {
        padding: 12px 32px;
        font-size: 16px;
      }

      .risk-modal-timer {
        font-size: 16px;
      }

      .risk-note {
        font-size: 13px;
        padding: 12px;
      }
    }

    /* ä½¿ç”¨æŒ‡å— */
    .usage-guide {
      background: var(--teal);
      color: var(--white);
      padding: 24px;
      border: 3px solid var(--black);
      box-shadow: 6px 6px 0px var(--black);
      margin-bottom: 24px;
      display: none;
    }

    .usage-guide.show {
      display: block;
    }

    .usage-guide h3 {
      font-family: var(--font-heading);
      font-size: 20px;
      font-weight: 700;
      text-transform: uppercase;
      margin-bottom: 16px;
      border-bottom: 2px solid var(--white);
      padding-bottom: 8px;
    }

    .usage-guide ol {
      margin-left: 20px;
      line-height: 2;
      font-weight: 600;
    }

    .usage-guide ol li {
      margin-bottom: 8px;
    }

    .usage-guide .file-name-highlight {
      background: var(--yellow-primary);
      color: var(--black);
      padding: 2px 8px;
      border: 2px solid var(--white);
      font-family: var(--font-heading);
      font-weight: 700;
    }

    /* å†å²è®°å½• */
    .history-item {
      background: var(--off-white);
      border: 2px solid var(--black);
      padding: 12px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      transition: all 0.2s ease-out;
    }

    .history-item:hover {
      transform: translate(-2px, -2px);
      box-shadow: 3px 3px 0px var(--black);
    }

    .history-info {
      flex: 1;
      min-width: 0;
    }

    .history-date {
      font-size: 12px;
      color: var(--medium-gray);
      font-weight: 600;
    }

    .history-name {
      font-size: 14px;
      font-weight: 600;
      color: var(--dark-gray);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .btn-small {
      padding: 8px 16px;
      font-size: 12px;
      box-shadow: 2px 2px 0px var(--black);
      white-space: nowrap;
    }

    .btn-small:hover:not(:disabled) {
      transform: translate(-1px, -1px);
      box-shadow: 3px 3px 0px var(--black);
    }

    .btn-small:active:not(:disabled) {
      transform: translate(0, 0);
      box-shadow: 1px 1px 0px var(--black);
    }

    .no-history {
      text-align: center;
      color: var(--medium-gray);
      font-size: 14px;
      padding: 24px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <!-- é£é™©è­¦å‘Šæ¨¡æ€æ¡† -->
  <div class="risk-modal-overlay" id="riskModal">
    <div class="risk-modal">
      <div class="risk-modal-header">
        <h2>âš ï¸ é‡è¦é£é™©è­¦å‘Š</h2>
      </div>
      <div class="risk-modal-body">
        <ul>
          <li><strong>ä½¿ç”¨æœ¬å·¥å…·å­˜åœ¨é£é™©</strong>ï¼Œé”™è¯¯çš„é…ç½®å¯èƒ½å¯¼è‡´è®¾å¤‡å‡ºç°é—®é¢˜æˆ–æ— æ³•å¼€æœº</li>
          <li><strong>åœ¨æ“ä½œå‰åŠ¡å¿…å¤‡ä»½æ‚¨çš„è®¾å¤‡</strong>ï¼Œä½¿ç”¨ iTunes æˆ– iCloud è¿›è¡Œå®Œæ•´å¤‡ä»½</li>
          <li>ç¡®ä¿æ‚¨çš„è®¾å¤‡ç³»ç»Ÿç‰ˆæœ¬æ”¯æŒï¼ˆ<strong>iOS 18.1+</strong>ï¼‰ï¼Œå‹å·ä¸è¾“å…¥å€¼å®Œå…¨åŒ¹é…</li>
          <li>æœ¬å·¥å…·ä»…ä¿®æ”¹ <strong>97JDvERpVwO+GHtthIh7hA</strong> å­—æ®µä¸ºç¾ç‰ˆå‹å·</li>
          <li>ç¨‹åºä¼šè‡ªåŠ¨æ›¿æ¢åœ°åŒºä»£ç ä¸º <strong>LL</strong> å’Œ <strong>LL/A</strong>ï¼Œå…¶ä»–å­—æ®µä¿æŒä¸å˜</li>
          <li><strong>ä½¿ç”¨ misaka26 æ—¶è¯·ä»”ç»†é˜…è¯»å®˜æ–¹è¯´æ˜æ–‡æ¡£</strong>ï¼Œé”™è¯¯æ“ä½œå¯èƒ½å¯¼è‡´ä¸¥é‡åæœ</li>
          <li>ä½œè€…ä¸å¯¹ä½¿ç”¨æœ¬å·¥å…·é€ æˆçš„ä»»ä½•é—®é¢˜è´Ÿè´£ï¼Œ<strong>æ‚¨éœ€è‡ªè¡Œæ‰¿æ‹…æ‰€æœ‰é£é™©</strong></li>
        </ul>
        <div class="risk-note">
          <strong>ğŸ“Œ æŠ€æœ¯è¯´æ˜ï¼š</strong>å¯¼å‡ºçš„æ–‡ä»¶ä½¿ç”¨æ ‡å‡† XML æ ¼å¼ï¼ŒMIME ç±»å‹è®¾ç½®ä¸º octet-stream ä»…ç”¨äºé¿å…æµè§ˆå™¨è‡ªåŠ¨æ·»åŠ  .xml åç¼€ï¼Œ<strong>ä¸ä¼šå½±å“ misaka26 è¯»å–æ–‡ä»¶</strong>ã€‚ç¨‹åºæ ¹æ®æ–‡ä»¶å†…å®¹è€Œé MIME ç±»å‹è¯†åˆ«æ–‡ä»¶ã€‚
        </div>
      </div>
      <div class="risk-modal-footer">
        <div class="risk-modal-timer" id="riskTimer">è¯·ä»”ç»†é˜…è¯»è­¦å‘Šï¼ˆ3 ç§’ï¼‰</div>
        <button class="risk-modal-btn" id="riskAcceptBtn" disabled>
          æˆ‘å·²äº†è§£é£é™©
        </button>
      </div>
    </div>
  </div>

  <!-- é»„è‰²æ¨ªå¹… -->
  <div class="warning-banner">
    <div class="warning-banner-text">
      <span style="margin: 0 30px;">MOBILEGESTALT EDITOR</span>
      <span style="margin: 0 30px;">EDIT PLIST FILES ONLINE</span>
      <span style="margin: 0 30px;">SIMPLE & SECURE</span>
      <span style="margin: 0 30px;">NO SERVER PROCESSING</span>
      <span style="margin: 0 30px;">MOBILEGESTALT EDITOR</span>
      <span style="margin: 0 30px;">EDIT PLIST FILES ONLINE</span>
      <span style="margin: 0 30px;">SIMPLE & SECURE</span>
      <span style="margin: 0 30px;">NO SERVER PROCESSING</span>
      <span style="margin: 0 30px;">MOBILEGESTALT EDITOR</span>
      <span style="margin: 0 30px;">EDIT PLIST FILES ONLINE</span>
      <span style="margin: 0 30px;">SIMPLE & SECURE</span>
      <span style="margin: 0 30px;">NO SERVER PROCESSING</span>
      <span style="margin: 0 30px;">MOBILEGESTALT EDITOR</span>
      <span style="margin: 0 30px;">EDIT PLIST FILES ONLINE</span>
      <span style="margin: 0 30px;">SIMPLE & SECURE</span>
      <span style="margin: 0 30px;">NO SERVER PROCESSING</span>
      <span style="margin: 0 30px;">MOBILEGESTALT EDITOR</span>
      <span style="margin: 0 30px;">EDIT PLIST FILES ONLINE</span>
      <span style="margin: 0 30px;">SIMPLE & SECURE</span>
      <span style="margin: 0 30px;">NO SERVER PROCESSING</span>
      <span style="margin: 0 30px;">MOBILEGESTALT EDITOR</span>
      <span style="margin: 0 30px;">EDIT PLIST FILES ONLINE</span>
      <span style="margin: 0 30px;">SIMPLE & SECURE</span>
      <span style="margin: 0 30px;">NO SERVER PROCESSING</span>
      <span style="margin: 0 30px;">MOBILEGESTALT EDITOR</span>
      <span style="margin: 0 30px;">EDIT PLIST FILES ONLINE</span>
      <span style="margin: 0 30px;">SIMPLE & SECURE</span>
      <span style="margin: 0 30px;">NO SERVER PROCESSING</span>
      <span style="margin: 0 30px;">MOBILEGESTALT EDITOR</span>
      <span style="margin: 0 30px;">EDIT PLIST FILES ONLINE</span>
      <span style="margin: 0 30px;">SIMPLE & SECURE</span>
      <span style="margin: 0 30px;">NO SERVER PROCESSING</span>
    </div>
  </div>

  <!-- ä¸»å®¹å™¨ -->
  <div class="container">
    <!-- æ ‡é¢˜åŒº -->
    <div class="header">
      <h1>MobileGestalt<br>Plist Editor</h1>
      <p>åœ¨çº¿ç¼–è¾‘å’Œä¿®æ”¹ MobileGestalt.plist æ–‡ä»¶ï¼Œæ”¯æŒè‡ªåŠ¨æ›¿æ¢å…³é”®å­—æ®µ</p>
      <div class="info-text">
        <div style="margin-bottom: 12px;">
          <strong>æ³¨æ„ï¼š</strong>æ‚¨æ— éœ€æ‰‹åŠ¨ä¿®æ”¹åœ°åŒºä»£ç ï¼ˆå¦‚ CHã€CH/A ç­‰ï¼‰ï¼Œç¨‹åºä¼šè‡ªåŠ¨å°†å…¶æ›¿æ¢ä¸º <strong>LL</strong> å’Œ <strong>LL/A</strong>ã€‚
        </div>
        <div style="margin-bottom: 12px;">
          å¦‚æœä¸æ¸…æ¥š A å¼€å¤´çš„å‹å·åº”è¯¥æ¢æˆä»€ä¹ˆï¼Œè¯·å‰å¾€ 
          <a href="https://support.apple.com/zh-cn/108044" 
             target="_blank" 
             rel="noopener noreferrer"
             style="color: var(--blue-primary); text-decoration: underline; font-weight: 600;">
            Apple å®˜æ–¹æ”¯æŒ
          </a> 
          æŸ¥æ‰¾æ‚¨çš„è®¾å¤‡å¯¹åº”çš„ç¾ç‰ˆå·ç ã€‚
        </div>
        <div style="padding-top: 12px; border-top: 2px solid var(--light-gray);">
          <strong>ä¸‹è½½å·¥å…·ï¼š</strong>ä¿®æ”¹å®Œæˆåéœ€è¦ä½¿ç”¨ <strong>misaka26 App</strong> åº”ç”¨é…ç½®æ–‡ä»¶ã€‚
          <a href="https://github.com/straight-tamago/misaka26/releases/" 
             target="_blank" 
             rel="noopener noreferrer"
             style="color: var(--blue-primary); text-decoration: underline; font-weight: 600;">
            å‰å¾€ GitHub ä¸‹è½½æœ€æ–°ç‰ˆ
          </a>
        </div>
      </div>
    </div>

    <!-- ä½¿ç”¨æŒ‡å— -->
    <div class="usage-guide" id="usageGuide">
      <h3>ä¸‹è½½æˆåŠŸï¼è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š</h3>
      <ol>
        <li>è¯·ç¡®è®¤ä¸‹è½½çš„æ–‡ä»¶åä¸ºï¼š<span class="file-name-highlight">com.apple.MobileGestalt.plist</span></li>
        <li>å°†æ­¤æ–‡ä»¶å‘é€åˆ°æ‚¨çš„ç”µè„‘ä¸Š</li>
        <li>æ‰“å¼€ <strong>misaka26 App</strong></li>
        <li>é€‰æ‹©åˆšæ‰ä¸‹è½½çš„ plist æ–‡ä»¶</li>
        <li>å‹¾é€‰ <strong>"Apple Intelligence (18.1 Beta, All Devices)"</strong></li>
        <li>ç‚¹å‡» <strong>Apply</strong> æŒ‰é’®å®Œæˆ</li>
      </ol>
      <div style="margin-top: 20px; padding: 16px; background: rgba(0,0,0,0.1); border: 2px solid rgba(255,255,255,0.3);">
        <strong>ğŸ“ æç¤ºï¼š</strong>å¦‚æœä¸‹è½½çš„æ–‡ä»¶åè¢«æ”¹ä¸º <code style="background: rgba(0,0,0,0.2); padding: 2px 6px; border-radius: 3px;">com.apple.MobileGestalt.plist.xml</code>ï¼Œ
        è¯·æ‰‹åŠ¨å°†æ–‡ä»¶é‡å‘½åä¸º <code style="background: #FFD60A; color: #000; padding: 2px 6px; border-radius: 3px; font-weight: 700;">com.apple.MobileGestalt.plist</code>ï¼ˆåˆ é™¤æœ«å°¾çš„ .xmlï¼‰
      </div>
    </div>

    <!-- è¾“å…¥å¡ç‰‡ -->
    <div class="card">
      <div class="card-header">
        <span class="badge">æ­¥éª¤ 1</span>
        <h2 class="card-title">ç²˜è´´ Plist æ–‡ä»¶</h2>
      </div>

      <div class="file-input-wrapper">
        <label for="fileInput" class="file-input-label">
          æˆ–è€…ä¸Šä¼ æ–‡ä»¶
        </label>
        <input type="file" id="fileInput" accept=".plist">
        <span class="file-name" id="fileName"></span>
      </div>

      <div class="input-group">
        <label class="input-label" for="plistInput">
          ç²˜è´´ Plist XML å†…å®¹ï¼š
        </label>
        <textarea 
          id="plistInput" 
          class="input-field" 
          placeholder="ç²˜è´´ com.apple.MobileGestalt.plist æ–‡ä»¶å†…å®¹..."
        ></textarea>
        <div class="error-message" id="inputError">è¯·è¾“å…¥æœ‰æ•ˆçš„ plist XML å†…å®¹</div>
      </div>

      <div class="btn-group">
        <button class="btn" id="parseBtn">
          å¼€å§‹è§£æ
        </button>
        <button class="btn btn-secondary" id="clearBtn">
          æ¸…ç©º
        </button>
      </div>
    </div>

    <!-- åŠ è½½çŠ¶æ€ -->
    <div class="loading" id="loading">
      æ­£åœ¨è§£ææ–‡ä»¶...
    </div>

    <!-- æŸ¥çœ‹å™¨å¡ç‰‡ -->
    <div class="card hidden" id="viewerCard">
      <div class="card-header">
        <span class="badge">æ­¥éª¤ 2</span>
        <h2 class="card-title">æŸ¥çœ‹ Plist å†…å®¹</h2>
      </div>

      <div class="plist-viewer show" id="plistViewer">
        <!-- æ ‘å½¢ç»“æ„å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
      </div>
    </div>

    <!-- ç¼–è¾‘å¡ç‰‡ -->
    <div class="card hidden" id="editCard">
      <div class="card-header">
        <span class="badge">æ­¥éª¤ 3</span>
        <h2 class="card-title">è¾“å…¥æ–°å€¼</h2>
      </div>

      <div class="input-group">
        <label class="input-label" for="newValue">
          97JDvERpVwO+GHtthIh7hA çš„æ–°å€¼ï¼ˆå¦‚ï¼šA3258ï¼‰ï¼š
        </label>
        <input 
          type="text" 
          id="newValue" 
          class="input-field small" 
          placeholder="A3258"
          maxlength="10"
        >
        <div class="error-message" id="valueError">è¯·è¾“å…¥æœ‰æ•ˆçš„å€¼ï¼ˆä¸å…è®¸ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦ï¼‰</div>
      </div>

      <div class="btn-group">
        <button class="btn btn-success" id="exportBtn">
          å¯¼å‡ºå¹¶ä¸‹è½½
        </button>
      </div>
    </div>

    <!-- å†å²è®°å½•å¡ç‰‡ -->
    <div class="card" id="historyCard">
      <div class="card-header">
        <span class="badge" style="background: var(--coral);">å†å²è®°å½•</span>
        <h2 class="card-title">åŸå§‹æ–‡ä»¶å†å²è®°å½•</h2>
      </div>

      <div id="historyList">
        <div class="no-history">æš‚æ— ä¿å­˜çš„æ–‡ä»¶</div>
      </div>
    </div>
  </div>

  <!-- é¡µè„š -->
  <footer class="footer">
    <div class="footer-content">
      <div class="footer-author">ä¹æµ·ä¸€ç²Ÿ</div>
      <div class="footer-copyright">ä¿ç•™æ‰€æœ‰æƒåˆ© Â© 2025</div>
    </div>
  </footer>

  <script>
    // å…¨å±€å˜é‡
    let plistDoc = null;
    let plistData = {};
    let originalPlistContent = '';
    const STORAGE_KEY = 'mobilegestalt_history';
    const MAX_HISTORY = 10;

    // DOM å…ƒç´ 
    const fileInput = document.getElementById('fileInput');
    const fileName = document.getElementById('fileName');
    const plistInput = document.getElementById('plistInput');
    const parseBtn = document.getElementById('parseBtn');
    const clearBtn = document.getElementById('clearBtn');
    const plistViewer = document.getElementById('plistViewer');
    const viewerCard = document.getElementById('viewerCard');
    const editCard = document.getElementById('editCard');
    const newValue = document.getElementById('newValue');
    const exportBtn = document.getElementById('exportBtn');
    const inputError = document.getElementById('inputError');
    const valueError = document.getElementById('valueError');
    const loading = document.getElementById('loading');
    const usageGuide = document.getElementById('usageGuide');
    const historyList = document.getElementById('historyList');
    
    // é£é™©è­¦å‘Šæ¨¡æ€æ¡†å…ƒç´ 
    const riskModal = document.getElementById('riskModal');
    const riskTimer = document.getElementById('riskTimer');
    const riskAcceptBtn = document.getElementById('riskAcceptBtn');

    // åˆå§‹åŒ–
    loadHistory();
    showRiskWarning();

    // æ–‡ä»¶ä¸Šä¼ å¤„ç†
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        fileName.textContent = file.name;
        const reader = new FileReader();
        reader.onload = (event) => {
          plistInput.value = event.target.result;
        };
        reader.readAsText(file);
      }
    });

    // æ¸…ç©ºæŒ‰é’®
    clearBtn.addEventListener('click', () => {
      plistInput.value = '';
      fileInput.value = '';
      fileName.textContent = '';
      viewerCard.classList.add('hidden');
      editCard.classList.add('hidden');
      inputError.classList.remove('show');
      plistInput.classList.remove('error');
      usageGuide.classList.remove('show');
      newValue.value = '';
      plistDoc = null;
      plistData = {};
      originalPlistContent = '';
    });

    // è§£ææŒ‰é’®
    parseBtn.addEventListener('click', () => {
      const xmlContent = plistInput.value.trim();
      
      if (!xmlContent) {
        showError(inputError, plistInput, 'è¯·è¾“å…¥æœ‰æ•ˆçš„ plist XML å†…å®¹');
        return;
      }

      loading.classList.add('show');
      inputError.classList.remove('show');
      plistInput.classList.remove('error');
      usageGuide.classList.remove('show');

      setTimeout(() => {
        try {
          // ä¿å­˜åŸå§‹å†…å®¹
          originalPlistContent = xmlContent;

          // è§£æ XML
          const parser = new DOMParser();
          plistDoc = parser.parseFromString(xmlContent, 'text/xml');

          // æ£€æŸ¥æ˜¯å¦æœ‰è§£æé”™è¯¯
          const parserError = plistDoc.querySelector('parsererror');
          if (parserError) {
            throw new Error('XML æ ¼å¼é”™è¯¯ï¼Œè¯·ç¡®ä¿ç²˜è´´çš„æ˜¯å®Œæ•´çš„ plist æ–‡ä»¶å†…å®¹ï¼ˆåŒ…å« <?xml å¼€å¤´æ ‡ç­¾ï¼‰');
          }

          // æ£€æŸ¥æ˜¯å¦æ˜¯ plist æ–‡ä»¶
          const plist = plistDoc.querySelector('plist');
          if (!plist) {
            throw new Error('è¿™ä¸æ˜¯æœ‰æ•ˆçš„ plist æ–‡ä»¶ï¼Œè¯·ç¡®ä¿ç²˜è´´çš„æ˜¯ com.apple.MobileGestalt.plist æ–‡ä»¶å†…å®¹');
          }

          // æŸ¥æ‰¾ CacheExtra å­—å…¸
          const cacheExtra = findCacheExtra(plistDoc);
          if (!cacheExtra) {
            throw new Error('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼šæœªæ‰¾åˆ° CacheExtra å­—å…¸ï¼Œè¯·ç¡®è®¤è¿™æ˜¯ä»è®¾å¤‡å¯¼å‡ºçš„ MobileGestalt.plist æ–‡ä»¶');
          }

          // è§£æ plist æ•°æ®
          plistData = parsePlistDict(cacheExtra);

          // éªŒè¯æ˜¯å¦åŒ…å«å¿…è¦å­—æ®µ
          const requiredKey = '97JDvERpVwO+GHtthIh7hA';
          if (!plistData[requiredKey]) {
            throw new Error('æ–‡ä»¶ç¼ºå°‘å¿…è¦çš„å­—æ®µï¼ˆ97JDvERpVwO+GHtthIh7hAï¼‰ï¼Œè¿™å¯èƒ½ä¸æ˜¯æ­£ç¡®çš„ MobileGestalt æ–‡ä»¶');
          }

          // æ˜¾ç¤ºæŸ¥çœ‹å™¨
          displayPlist(plistData);
          viewerCard.classList.remove('hidden');
          editCard.classList.remove('hidden');

          // æ»šåŠ¨åˆ°æŸ¥çœ‹å™¨
          viewerCard.scrollIntoView({ behavior: 'smooth', block: 'start' });

        } catch (error) {
          let errorMsg = 'è§£æå¤±è´¥ï¼š' + error.message;
          
          // æ·»åŠ å¸®åŠ©æç¤º
          if (error.message.includes('XML')) {
            errorMsg += '\n\nğŸ’¡ æç¤ºï¼šè¯·ç¡®ä¿å¤åˆ¶äº†å®Œæ•´çš„æ–‡ä»¶å†…å®¹ï¼ŒåŒ…æ‹¬ç¬¬ä¸€è¡Œçš„ <?xml version="1.0" encoding="UTF-8"?>';
          } else if (error.message.includes('CacheExtra')) {
            errorMsg += '\n\nğŸ’¡ æç¤ºï¼šè¯·ç¡®è®¤è¿™æ˜¯ä» iPhone è®¾ç½®ä¸­å¯¼å‡ºçš„ com.apple.MobileGestalt.plist æ–‡ä»¶';
          }
          
          showError(inputError, plistInput, errorMsg);
          viewerCard.classList.add('hidden');
          editCard.classList.add('hidden');
        } finally {
          loading.classList.remove('show');
        }
      }, 300);
    });

    // è¾“å…¥éªŒè¯
    newValue.addEventListener('input', (e) => {
      // ç§»é™¤ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦
      e.target.value = e.target.value.replace(/[^A-Za-z0-9]/g, '');
      valueError.classList.remove('show');
      newValue.classList.remove('error');
    });

    // å¯¼å‡ºæŒ‰é’®
    exportBtn.addEventListener('click', () => {
      const value = newValue.value.trim();
      
      if (!value || !/^[A-Za-z0-9]+$/.test(value)) {
        showError(valueError, newValue, 'è¯·è¾“å…¥æœ‰æ•ˆçš„å€¼ï¼ˆä¸å…è®¸ç©ºæ ¼å’Œç‰¹æ®Šå­—ç¬¦ï¼‰');
        return;
      }

      if (!plistDoc) {
        alert('è¯·å…ˆè§£æ plist æ–‡ä»¶');
        return;
      }

      try {
        // ä¿®æ”¹å€¼
        modifyPlistValues(plistDoc, value);

        // ç”Ÿæˆ XML å­—ç¬¦ä¸²
        const serializer = new XMLSerializer();
        let xmlString = serializer.serializeToString(plistDoc);

        // æ·»åŠ  XML å£°æ˜ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰
        if (!xmlString.startsWith('<?xml')) {
          xmlString = '<?xml version="1.0" encoding="UTF-8"?>\n' + xmlString;
        }

        // ä¿å­˜åˆ°å†å²è®°å½•
        saveToHistory(originalPlistContent);

        // ä¸‹è½½æ–‡ä»¶
        downloadFile(xmlString, 'com.apple.MobileGestalt.plist');

        // æ˜¾ç¤ºä½¿ç”¨æŒ‡å—
        usageGuide.classList.add('show');
        
        // æ»šåŠ¨åˆ°ä½¿ç”¨æŒ‡å—
        setTimeout(() => {
          usageGuide.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);

        // 10ç§’åè‡ªåŠ¨éšè—
        setTimeout(() => {
          usageGuide.classList.remove('show');
        }, 30000);

      } catch (error) {
        alert('å¯¼å‡ºå¤±è´¥ï¼š' + error.message);
      }
    });

    // æŸ¥æ‰¾ CacheExtra å­—å…¸
    function findCacheExtra(doc) {
      const dicts = doc.querySelectorAll('dict');
      for (let dict of dicts) {
        const prevKey = dict.previousElementSibling;
        if (prevKey && prevKey.tagName === 'key' && prevKey.textContent === 'CacheExtra') {
          return dict;
        }
      }
      return null;
    }

    // è§£æ plist å­—å…¸
    function parsePlistDict(dictElement) {
      const result = {};
      const children = Array.from(dictElement.children);
      
      for (let i = 0; i < children.length; i += 2) {
        const keyElement = children[i];
        const valueElement = children[i + 1];
        
        if (keyElement && keyElement.tagName === 'key' && valueElement) {
          const key = keyElement.textContent;
          const value = parsePlistValue(valueElement);
          result[key] = value;
        }
      }
      
      return result;
    }

    // è§£æ plist å€¼
    function parsePlistValue(element) {
      const tag = element.tagName.toLowerCase();
      
      switch (tag) {
        case 'string':
          return { type: 'string', value: element.textContent };
        case 'integer':
          return { type: 'integer', value: element.textContent };
        case 'real':
          return { type: 'real', value: element.textContent };
        case 'true':
          return { type: 'boolean', value: 'true' };
        case 'false':
          return { type: 'boolean', value: 'false' };
        case 'data':
          return { type: 'data', value: element.textContent.substring(0, 50) + '...' };
        case 'array':
          return { type: 'array', value: parseArray(element) };
        case 'dict':
          return { type: 'dict', value: parsePlistDict(element) };
        default:
          return { type: 'unknown', value: element.textContent };
      }
    }

    // è§£ææ•°ç»„
    function parseArray(arrayElement) {
      const items = [];
      for (let child of arrayElement.children) {
        items.push(parsePlistValue(child));
      }
      return items;
    }

    // æ˜¾ç¤º plist å†…å®¹
    function displayPlist(data) {
      const ul = document.createElement('ul');
      ul.className = 'plist-tree';
      
      // æ˜¾ç¤ºå…³é”®å­—æ®µ
      const highlightKeys = [
        '97JDvERpVwO+GHtthIh7hA',
        'zHeENZu+wbg7PUprwNwBWg',
        'h63QSdBCiT/z0WU6rdQv6Q'
      ];

      for (let key in data) {
        const li = createPlistItem(key, data[key], highlightKeys.includes(key));
        ul.appendChild(li);
      }

      plistViewer.innerHTML = '';
      plistViewer.appendChild(ul);
    }

    // åˆ›å»º plist é¡¹ç›®
    function createPlistItem(key, valueObj, highlight = false) {
      const li = document.createElement('li');
      li.className = 'plist-item';

      const keySpan = document.createElement('span');
      keySpan.className = 'plist-key';
      keySpan.textContent = key;

      const typeSpan = document.createElement('span');
      typeSpan.className = 'plist-type';
      typeSpan.textContent = `(${valueObj.type})`;

      const valueSpan = document.createElement('span');
      valueSpan.className = 'plist-value' + (highlight ? ' highlight' : '');

      if (valueObj.type === 'dict' || valueObj.type === 'array') {
        valueSpan.textContent = valueObj.type === 'dict' ? '{ ... }' : '[ ... ]';
      } else {
        valueSpan.textContent = valueObj.value;
      }

      li.appendChild(keySpan);
      li.appendChild(typeSpan);
      li.appendChild(valueSpan);

      return li;
    }

    // ä¿®æ”¹ plist å€¼
    // ä»…ä¿®æ”¹ä¸‰ä¸ªå®‰å…¨å­—æ®µï¼Œä¸å½±å“å…¶ä»–ç³»ç»Ÿé…ç½®
    function modifyPlistValues(doc, newModelValue) {
      const cacheExtra = findCacheExtra(doc);
      if (!cacheExtra) {
        throw new Error('æœªæ‰¾åˆ° CacheExtra å­—å…¸');
      }

      const keys = Array.from(cacheExtra.querySelectorAll('key'));
      let modifiedCount = 0;
      
      // ä¿®æ”¹ 97JDvERpVwO+GHtthIh7hA - è®¾å¤‡å‹å·æ ‡è¯†ç¬¦
      for (let keyElement of keys) {
        if (keyElement.textContent === '97JDvERpVwO+GHtthIh7hA') {
          const valueElement = keyElement.nextElementSibling;
          if (valueElement && valueElement.tagName === 'string') {
            valueElement.textContent = newModelValue;
            modifiedCount++;
          }
        }
        // ä¿®æ”¹ zHeENZu+wbg7PUprwNwBWg ä¸º LL/A - åœ°åŒºä»£ç ï¼ˆå®Œæ•´ï¼‰
        else if (keyElement.textContent === 'zHeENZu+wbg7PUprwNwBWg') {
          const valueElement = keyElement.nextElementSibling;
          if (valueElement && valueElement.tagName === 'string') {
            valueElement.textContent = 'LL/A';
            modifiedCount++;
          }
        }
        // ä¿®æ”¹ h63QSdBCiT/z0WU6rdQv6Q ä¸º LL - åœ°åŒºä»£ç ï¼ˆç®€å†™ï¼‰
        else if (keyElement.textContent === 'h63QSdBCiT/z0WU6rdQv6Q') {
          const valueElement = keyElement.nextElementSibling;
          if (valueElement && valueElement.tagName === 'string') {
            valueElement.textContent = 'LL';
            modifiedCount++;
          }
        }
      }

      // éªŒè¯æ˜¯å¦æˆåŠŸä¿®æ”¹äº†æ‰€æœ‰å¿…è¦å­—æ®µ
      if (modifiedCount < 3) {
        console.warn('è­¦å‘Šï¼šéƒ¨åˆ†å­—æ®µæœªæ‰¾åˆ°æˆ–æœªä¿®æ”¹ï¼Œå·²ä¿®æ”¹ ' + modifiedCount + ' ä¸ªå­—æ®µ');
      }
    }

    // ä¸‹è½½æ–‡ä»¶
    function downloadFile(content, filename) {
      // ä½¿ç”¨ octet-stream å¼ºåˆ¶æµè§ˆå™¨æŒ‰åŸæ ·ä¸‹è½½ï¼Œé¿å…è‡ªåŠ¨æ·»åŠ  .xml åç¼€
      const blob = new Blob([content], { type: 'application/octet-stream' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      
      // å¼ºåˆ¶è®¾ç½®æ–‡ä»¶åï¼Œç¡®ä¿ä¸è¢«ä¿®æ”¹
      a.setAttribute('download', filename);
      
      document.body.appendChild(a);
      a.click();
      
      // å»¶è¿Ÿæ¸…ç†ï¼Œç¡®ä¿ä¸‹è½½å®Œæˆ
      setTimeout(() => {
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }, 100);
    }

    // æ˜¾ç¤ºé”™è¯¯
    function showError(errorElement, inputElement, message) {
      errorElement.textContent = message;
      errorElement.classList.add('show');
      inputElement.classList.add('error');
    }

    // ä¿å­˜åˆ°å†å²è®°å½•
    function saveToHistory(content) {
      try {
        let history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        
        // æ·»åŠ æ–°è®°å½•
        const record = {
          id: Date.now(),
          content: content,
          date: new Date().toLocaleString('zh-CN', {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit',
            hour: '2-digit',
            minute: '2-digit'
          }),
          fileName: 'åŸå§‹æ–‡ä»¶_' + new Date().getTime()
        };

        history.unshift(record);

        // é™åˆ¶æœ€å¤§æ•°é‡
        if (history.length > MAX_HISTORY) {
          history = history.slice(0, MAX_HISTORY);
        }

        localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
        loadHistory();
      } catch (error) {
        console.error('ä¿å­˜å†å²è®°å½•å¤±è´¥:', error);
      }
    }

    // åŠ è½½å†å²è®°å½•
    function loadHistory() {
      try {
        const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        
        if (history.length === 0) {
          historyList.innerHTML = '<div class="no-history">æš‚æ— ä¿å­˜çš„æ–‡ä»¶</div>';
          return;
        }

        historyList.innerHTML = '';
        history.forEach(record => {
          const div = document.createElement('div');
          div.className = 'history-item';
          div.innerHTML = `
            <div class="history-info">
              <div class="history-date">${record.date}</div>
              <div class="history-name">${record.fileName}.plist</div>
            </div>
            <button class="btn btn-secondary btn-small" onclick="downloadHistory(${record.id})">
              ä¸‹è½½åŸæ–‡ä»¶
            </button>
          `;
          historyList.appendChild(div);
        });
      } catch (error) {
        console.error('åŠ è½½å†å²è®°å½•å¤±è´¥:', error);
        historyList.innerHTML = '<div class="no-history">åŠ è½½å¤±è´¥</div>';
      }
    }

    // ä¸‹è½½å†å²è®°å½•
    window.downloadHistory = function(id) {
      try {
        const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
        const record = history.find(r => r.id === id);
        
        if (record) {
          downloadFile(record.content, record.fileName + '.plist');
        }
      } catch (error) {
        alert('ä¸‹è½½å¤±è´¥ï¼š' + error.message);
      }
    };

    // æ¸…ç©ºå†å²è®°å½•ï¼ˆå¯é€‰åŠŸèƒ½ï¼Œæš‚ä¸æ·»åŠ æŒ‰é’®ï¼‰
    window.clearHistory = function() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²è®°å½•å—ï¼Ÿ')) {
        localStorage.removeItem(STORAGE_KEY);
        loadHistory();
      }
    };

    // æ˜¾ç¤ºé£é™©è­¦å‘Šæ¨¡æ€æ¡†ï¼ˆæ¯æ¬¡æ‰“å¼€/åˆ·æ–°é¡µé¢éƒ½æ˜¾ç¤ºï¼‰
    function showRiskWarning() {
      let countdown = 3;
      riskModal.classList.remove('hidden');
      riskAcceptBtn.disabled = true;
      riskAcceptBtn.classList.remove('active');
      
      // æ›´æ–°å€’è®¡æ—¶æ˜¾ç¤º
      function updateTimer() {
        if (countdown > 0) {
          riskTimer.textContent = `è¯·ä»”ç»†é˜…è¯»è­¦å‘Šï¼ˆ${countdown} ç§’ï¼‰`;
          countdown--;
          setTimeout(updateTimer, 1000);
        } else {
          riskTimer.textContent = 'æ‚¨å¯ä»¥å…³é—­æ­¤è­¦å‘Šäº†';
          riskAcceptBtn.disabled = false;
          riskAcceptBtn.classList.add('active');
        }
      }
      
      updateTimer();
      
      // å…³é—­æŒ‰é’®äº‹ä»¶
      riskAcceptBtn.addEventListener('click', () => {
        if (!riskAcceptBtn.disabled) {
          riskModal.classList.add('hidden');
        }
      });
      
      // é˜²æ­¢ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
      riskModal.addEventListener('click', (e) => {
        if (e.target === riskModal && !riskAcceptBtn.disabled) {
          riskModal.classList.add('hidden');
        }
      });
    }
  </script>
</body>
</html>

